@model WebApplication1.Models.StudentPredmetiModel

<h2>Uredi predmete i ocjene: @Model.ImePrezime</h2>

<form asp-controller="Dekan"
      asp-action="EditPredmeti"
      method="post">
    @Html.AntiForgeryToken()

    <input type="hidden" asp-for="StudentId" />
    <input type="hidden" asp-for="ImePrezime" />

    @* Prikaži eventualne greške *@
    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger">
            <ul>
                @foreach (var e in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                {
                    <li>@e.ErrorMessage</li>
                }
            </ul>
        </div>
    }

    <div class="mb-4">
        @for (int i = 0; i < Model.Predmeti.Count; i++)
        {
            <div class="row align-items-center mb-2">

                @* Hidden fields za binder *@
                <input type="hidden" asp-for="Predmeti[@i].PredmetID" />
                <input type="hidden" asp-for="Predmeti[@i].ImePredmeta" />

                <div class="col-auto form-check">
                    <input asp-for="Predmeti[@i].IsSelected"
                           class="form-check-input item-checkbox"
                           type="checkbox"
                           data-index="@i"
                           id="checkbox_@i" />
                </div>
                <div class="col">
                    <label class="form-check-label" for="checkbox_@i">
                        @Model.Predmeti[i].ImePredmeta
                    </label>
                </div>
                <div class="col-auto">
                    <select asp-for="Predmeti[@i].Ocjena"
                            class="form-select ocjena-select"
                            data-index="@i"
                            id="select_@i"
                            style="display:@(Model.Predmeti[i].IsSelected ? "inline-block" : "none")">
                        <option value="">–</option>
                        @for (int g = 6; g <= 10; g++)
                        {
                            <option value="@g">@g</option>
                        }
                    </select>
                </div>
            </div>
        }
    </div>

    <button type="submit" class="btn btn-success">Spremi promjene</button>
    <a asp-action="PregledStudenata" class="btn btn-secondary ms-2">Otkaži</a>
</form>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.item-checkbox').forEach(function(cb) {
                var idx = cb.getAttribute('data-index');
                var sel = document.querySelector('.ocjena-select[data-index="' + idx + '"]');

                function toggleSelect() {
                    if (cb.checked) {
                        sel.style.display = 'inline-block';
                        sel.disabled = false;
                    } else {
                        sel.style.display = 'none';
                        sel.disabled = true;
                        sel.value = '';
                    }
                }

                cb.addEventListener('change', toggleSelect);
                // inicijalno stanje
                toggleSelect();
            });
        });
    </script>
}
